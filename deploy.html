<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ä¸‰è„šçŒ«æ‹æ‘„æ¡£æœŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        safelist: [
          { pattern: /bg-(green|blue|pink|purple|orange|emerald|sky|rose|violet|gray)-(50|100|200|400|500|600|700|800)/ },
          { pattern: /text-(green|blue|pink|purple|orange|emerald|sky|rose|violet|gray)-(50|100|200|400|500|600|700|800)/ },
          { pattern: /ring-(green|blue|pink|purple|orange|emerald|sky|rose|violet|gray)-(50|100|200|400|500|600|700|800)/ }
        ]
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: 'Quicksand', 'Noto Sans SC', sans-serif;
        background-color: #FFF7ED;
        -webkit-tap-highlight-color: transparent;
      }
      .cat-scroll::-webkit-scrollbar { width: 8px; }
      .cat-scroll::-webkit-scrollbar-track { background: #ffedd5; }
      .cat-scroll::-webkit-scrollbar-thumb { background-color: #fb923c; border-radius: 20px; border: 2px solid #ffedd5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
        const { useState, useEffect, useMemo } = React;

        // --- Utils ---
        const uuidv4 = () => {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        };

        // --- Icons ---
        const Icon = ({ path, className, ...props }) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {path}
            </svg>
        );

        const Icons = {
            ChevronLeft: (p) => <Icon path={<path d="M15 18l-6-6 6-6" />} {...p} />,
            ChevronRight: (p) => <Icon path={<path d="M9 18l6-6-6-6" />} {...p} />,
            Plus: (p) => <Icon path={<path d="M12 5v14M5 12h14" />} {...p} />,
            Bell: (p) => <Icon path={<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" />} {...p} />,
            Menu: (p) => <Icon path={<path d="M3 12h18M3 6h18M3 18h18" />} {...p} />,
            Calendar: (p) => <Icon path={<rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" />} {...p} />,
            X: (p) => <Icon path={<path d="M18 6L6 18M6 6l12 12" />} {...p} />,
            Save: (p) => <Icon path={<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" />} {...p} />,
            FileText: (p) => <Icon path={<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" />} {...p} />,
            Trash2: (p) => <Icon path={<polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" />} {...p} />,
            Tag: (p) => <Icon path={<path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" /><line x1="7" y1="7" x2="7.01" y2="7" />} {...p} />,
        };

        const CatPawIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d="M12 2C10.5 2 9.2 3.1 9 4.6C8.8 6.1 9.8 7.5 11.2 7.8C12.7 8 14 6.9 14.2 5.4C14.4 3.9 13.4 2.5 12 2M7.5 4.5C6 4.5 4.7 5.6 4.5 7.1C4.3 8.6 5.3 10 6.8 10.2C8.2 10.4 9.5 9.4 9.7 7.9C9.9 6.4 8.9 5 7.5 4.5M16.5 4.5C15.1 4.5 13.8 5.6 13.6 7.1C13.4 8.6 14.4 10 15.9 10.2C17.3 10.4 18.6 9.4 18.8 7.9C19 6.4 18 5 16.5 4.5M4.8 12.8C3.8 14.2 3.8 16.2 5 17.6C6.2 19.1 8.2 19.4 10.2 18.8C10.7 20.3 12.1 21.4 13.8 21.4C16.1 21.4 18 19.5 18 17.2C18 16.3 17.7 15.5 17.2 14.8C18.4 13.8 19 12.2 18.6 10.5C18.1 8.5 16.1 7.2 14 7.7C13.2 7.9 12.5 8.3 12 8.8C11.5 8.3 10.8 7.9 10 7.7C7.9 7.2 5.9 8.5 5.4 10.5C5.3 11.3 5.4 12.1 5.8 12.8H4.8Z" />
            </svg>
        );

        const CatFaceIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 5c.67 0 1.35.09 2 .26 1.78-2 5.03-2.84 6.42-2.26 1.4.58-.42 7-.42 7 .57 1.07 1 2.24 1 3.44C21 17.9 16.97 21 12 21S3 17.9 3 13.44c0-1.2.43-2.37 1-3.44 0 0-1.82-6.42-.42-7 1.39-.58 4.64.26 6.42 2.26.65-.17 1.33-.26 2-.26z" />
                <path d="M9 13v.01" />
                <path d="M15 13v.01" />
                <path d="M10 16.5c1 .5 3 .5 4 0" />
            </svg>
        );

        // --- Constants ---
        const DEFAULT_TAGS = [
            { id: '1', name: 'å¤–æ™¯æ‹æ‘„', color: 'bg-green-100 text-green-700' },
            { id: '2', name: 'æ£šå†…æ‹æ‘„', color: 'bg-blue-100 text-blue-700' },
            { id: '3', name: 'æ–°ç”Ÿå„¿', color: 'bg-pink-100 text-pink-700' },
            { id: '4', name: 'å©šç¤¼è·Ÿæ‹', color: 'bg-purple-100 text-purple-700' },
            { id: '5', name: 'å® ç‰©æ‘„å½±', color: 'bg-orange-100 text-orange-700' },
        ];

        const TAG_COLORS = [
            { label: 'è–„è·ç»¿', value: 'bg-emerald-100 text-emerald-700' },
            { label: 'å¤©ç©ºè“', value: 'bg-sky-100 text-sky-700' },
            { label: 'èœœæ¡ƒç²‰', value: 'bg-rose-100 text-rose-700' },
            { label: 'é¦™èŠ‹ç´«', value: 'bg-violet-100 text-violet-700' },
            { label: 'æ©˜çŒ«é»„', value: 'bg-orange-100 text-orange-700' },
            { label: 'çŸ³å¢¨ç°', value: 'bg-gray-100 text-gray-700' },
        ];

        const WEEKDAYS = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        // --- Storage Service ---
        const SESSIONS_KEY = 'meow_schedule_sessions';
        const TAGS_KEY = 'meow_schedule_tags';

        const saveSessions = (sessions) => localStorage.setItem(SESSIONS_KEY, JSON.stringify(sessions));
        const getSessions = () => {
            const data = localStorage.getItem(SESSIONS_KEY);
            return data ? JSON.parse(data) : [];
        };
        const saveTags = (tags) => localStorage.setItem(TAGS_KEY, JSON.stringify(tags));
        const getTags = () => {
            const data = localStorage.getItem(TAGS_KEY);
            return data ? JSON.parse(data) : DEFAULT_TAGS;
        };

        // --- Components ---

        const SessionForm = ({ existingTags, initialDate, initialData, onSave, onDelete, onCancel }) => {
            const [date, setDate] = useState(initialDate || new Date().toISOString().split('T')[0]);
            const [notes, setNotes] = useState('');
            const [selectedTags, setSelectedTags] = useState([]);

            useEffect(() => {
                if (initialData) {
                    setDate(initialData.date);
                    setNotes(initialData.notes || '');
                    setSelectedTags(initialData.tags);
                } else if (initialDate) {
                    setDate(initialDate);
                }
            }, [initialData, initialDate]);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                const tagNames = selectedTags
                .map(id => existingTags.find(t => t.id === id)?.name)
                .filter(Boolean);
                const generatedTitle = tagNames.length > 0 ? tagNames.join(' + ') : 'æ‹æ‘„æ¡£æœŸ';
                const sessionData = {
                    title: generatedTitle,
                    clientName: 'å®¢æˆ·',
                    date,
                    time: '00:00',
                    tags: selectedTags,
                    notes
                };
                if (initialData) {
                    onSave({ ...sessionData, id: initialData.id });
                } else {
                    onSave(sessionData);
                }
            };

            const toggleTag = (tagId) => {
                setSelectedTags(prev => 
                prev.includes(tagId) ? prev.filter(id => id !== tagId) : [...prev, tagId]
                );
            };

            const handleDelete = () => {
                if (initialData && onDelete) {
                    onDelete(initialData.id);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-xl p-6 border-4 border-orange-100 relative overflow-hidden">
                    <div className="absolute -top-6 -left-6 w-20 h-20 bg-orange-100 rounded-full opacity-50 pointer-events-none" />
                    <div className="absolute -bottom-6 -right-6 w-24 h-24 bg-orange-50 rounded-full pointer-events-none" />

                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-orange-800 flex items-center gap-2">
                        <CatPawIcon className="w-6 h-6 text-orange-500" />
                        {initialData ? 'ç¼–è¾‘æ‹æ‘„æ¡£æœŸ' : 'æ–°å¢æ‹æ‘„æ¡£æœŸ'}
                        </h2>
                        <button onClick={onCancel} className="p-2 hover:bg-orange-50 rounded-full text-orange-400 hover:text-orange-600 transition-colors">
                        <Icons.X className="w-6 h-6" />
                        </button>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-6">
                        <div>
                        <label className="block text-sm font-bold text-orange-800 uppercase mb-3 ml-1">1. é€‰æ‹©æ‹æ‘„ç±»å‹ (æ ‡ç­¾)</label>
                        <div className="flex flex-wrap gap-3 bg-orange-50 p-4 rounded-2xl border border-orange-100">
                            {existingTags.map(tag => (
                            <button
                                key={tag.id}
                                type="button"
                                onClick={() => toggleTag(tag.id)}
                                className={`px-4 py-2 rounded-xl text-sm font-bold transition-all transform hover:scale-105 flex items-center gap-2 ${
                                selectedTags.includes(tag.id)
                                    ? tag.color + ' ring-2 ring-offset-2 ring-orange-200 shadow-md scale-105'
                                    : 'bg-white text-gray-500 hover:bg-white shadow-sm border border-gray-100'
                                }`}
                            >
                                <span className={`w-2 h-2 rounded-full ${tag.color.split(' ')[0]}`} />
                                {tag.name}
                            </button>
                            ))}
                            {existingTags.length === 0 && (
                            <p className="text-gray-400 text-sm">æš‚æ— æ ‡ç­¾ï¼Œè¯·åœ¨ä¾§è¾¹æ æ·»åŠ </p>
                            )}
                        </div>
                        </div>

                        <div>
                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">æ—¥æœŸ</label>
                        <div className="relative">
                            <Icons.Calendar className="absolute left-3 top-3 text-gray-400 w-5 h-5" />
                            <input
                            required
                            type="date"
                            value={date}
                            onChange={(e) => setDate(e.target.value)}
                            className="w-full pl-10 pr-4 py-3 border-2 border-gray-100 rounded-xl focus:border-orange-300 focus:outline-none transition-colors bg-gray-50/50"
                            />
                        </div>
                        </div>

                        <div>
                        <label className="block text-sm font-bold text-orange-800 uppercase mb-2 ml-1">2. æ‹æ‘„å¤‡æ³¨</label>
                        <div className="relative">
                            <Icons.FileText className="absolute left-3 top-3 text-gray-400 w-5 h-5" />
                            <textarea
                            required
                            value={notes}
                            onChange={(e) => setNotes(e.target.value)}
                            rows={4}
                            className="w-full pl-10 pr-4 py-3 border-2 border-gray-100 rounded-xl focus:border-orange-300 focus:outline-none transition-colors resize-none bg-gray-50/50"
                            placeholder="è¯·è¾“å…¥å…·ä½“çš„æ‹æ‘„å†…å®¹ã€å®¢æˆ·éœ€æ±‚æˆ–æ³¨æ„äº‹é¡¹..."
                            />
                        </div>
                        </div>

                        <div className="pt-2 flex gap-3">
                        {initialData && (
                            <button
                            type="button"
                            onClick={handleDelete}
                            className="flex-1 bg-red-50 text-red-500 font-bold py-4 px-6 rounded-2xl hover:bg-red-100 transition-colors flex justify-center items-center gap-2 shadow-sm border border-red-100"
                            >
                            <Icons.Trash2 className="w-5 h-5" />
                            åˆ é™¤
                            </button>
                        )}
                        <button
                            type="submit"
                            className="flex-[2] bg-orange-500 text-white font-bold py-4 px-6 rounded-2xl hover:bg-orange-600 transition-colors shadow-lg hover:shadow-orange-200 flex justify-center items-center gap-2 group"
                        >
                            <Icons.Save className="w-5 h-5 group-hover:scale-110 transition-transform" />
                            {initialData ? 'ä¿å­˜ä¿®æ”¹' : 'ä¿å­˜å–µå–µæ¡£æœŸ'}
                        </button>
                        </div>
                    </form>
                </div>
            );
        };

        const TagManager = ({ tags, onAdd, onDelete }) => {
            const [newTagName, setNewTagName] = useState('');
            const [selectedColor, setSelectedColor] = useState(TAG_COLORS[0].value);

            const handleAdd = () => {
                if (newTagName.trim()) {
                onAdd({ name: newTagName, color: selectedColor });
                setNewTagName('');
                }
            };

            return (
                <div className="bg-white rounded-3xl p-6 shadow-sm border border-orange-100">
                <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <Icons.Tag className="text-orange-400" />
                    æ ‡ç­¾ç®¡ç†
                </h3>
                
                <div className="flex flex-col md:flex-row gap-3 mb-6 items-end">
                    <div className="flex-1 w-full">
                    <label className="block text-xs text-gray-400 mb-1 ml-1">æ–°æ ‡ç­¾åç§°</label>
                    <input
                        type="text"
                        value={newTagName}
                        onChange={(e) => setNewTagName(e.target.value)}
                        placeholder="ä¾‹å¦‚ï¼šäº²å­å†™çœŸ"
                        className="w-full px-4 py-2 rounded-xl border-2 border-gray-100 focus:border-orange-300 outline-none"
                        onKeyDown={(e) => e.key === 'Enter' && handleAdd()}
                    />
                    </div>
                    <div className="w-full md:w-auto">
                    <label className="block text-xs text-gray-400 mb-1 ml-1">é€‰æ‹©é¢œè‰²</label>
                    <div className="flex gap-2 bg-gray-50 p-2 rounded-xl border border-gray-100">
                        {TAG_COLORS.map((color) => (
                        <button
                            key={color.label}
                            onClick={() => setSelectedColor(color.value)}
                            className={`w-6 h-6 rounded-full ${color.value.split(' ')[0]} ${
                            selectedColor === color.value ? 'ring-2 ring-gray-400 ring-offset-2' : ''
                            }`}
                            title={color.label}
                        />
                        ))}
                    </div>
                    </div>
                    <button
                    onClick={handleAdd}
                    disabled={!newTagName.trim()}
                    className="bg-orange-500 text-white p-2.5 rounded-xl hover:bg-orange-600 disabled:opacity-50 transition-colors"
                    >
                    <Icons.Plus className="w-6 h-6" />
                    </button>
                </div>

                <div className="space-y-2">
                    {tags.map((tag) => (
                    <div key={tag.id} className="flex items-center justify-between p-3 rounded-xl hover:bg-orange-50 transition-colors group">
                        <div className="flex items-center gap-3">
                        <span className={`w-3 h-3 rounded-full ${tag.color.split(' ')[0]}`} />
                        <span className="font-medium text-gray-700">{tag.name}</span>
                        </div>
                        <button
                        onClick={() => onDelete(tag.id)}
                        className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"
                        >
                        <Icons.Trash2 className="w-5 h-5" />
                        </button>
                    </div>
                    ))}
                </div>
                </div>
            );
        };

        const App = () => {
            // State
            const [sessions, setSessions] = useState([]);
            const [tags, setTags] = useState([]);
            const [currentDate, setCurrentDate] = useState(new Date()); 
            const [selectedDate, setSelectedDate] = useState(undefined); 
            const [isFormOpen, setIsFormOpen] = useState(false);
            const [editingSession, setEditingSession] = useState(null);
            const [viewMode, setViewMode] = useState('calendar');
            const [showNotification, setShowNotification] = useState([]);

            // Load Data
            useEffect(() => {
                setSessions(getSessions());
                setTags(getTags());
            }, []);

            // Save Data effects
            useEffect(() => {
                saveSessions(sessions);
            }, [sessions]);

            useEffect(() => {
                saveTags(tags);
            }, [tags]);

            // Check for tomorrow's sessions for notification
            useEffect(() => {
                const checkReminders = () => {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];

                const upcoming = sessions.filter(s => s.date === tomorrowStr);
                
                if (upcoming.length > 0) {
                    setShowNotification(upcoming);
                    if (Notification.permission === "granted") {
                        new Notification("å–µå–µæé†’ ğŸ±", {
                            body: `æ˜å¤©æœ‰ ${upcoming.length} ä¸ªæ‹æ‘„æ¡£æœŸï¼Œè¯·åšå¥½å‡†å¤‡ï¼`,
                            icon: "https://cdn-icons-png.flaticon.com/512/616/616430.png"
                        });
                    } else if (Notification.permission !== "denied") {
                        Notification.requestPermission();
                    }
                }
                };
                
                if (sessions.length > 0) {
                    checkReminders();
                }
            }, [sessions]);

            // Calendar Logic (3 Weeks)
            const startOfView = useMemo(() => {
                const d = new Date(currentDate);
                const day = d.getDay(); 
                const diff = d.getDate() - day; 
                return new Date(d.setDate(diff));
            }, [currentDate]);

            const calendarDays = useMemo(() => {
                const days = [];
                for (let i = 0; i < 21; i++) {
                const d = new Date(startOfView);
                d.setDate(d.getDate() + i);
                days.push(d);
                }
                return days;
            }, [startOfView]);

            const headerDate = calendarDays[6] || startOfView;

            const changeWeeks = (delta) => {
                const newDate = new Date(currentDate);
                newDate.setDate(newDate.getDate() + (delta * 21));
                setCurrentDate(newDate);
            };

            const handleSaveSession = (sessionData) => {
                if ('id' in sessionData) {
                    setSessions(prev => prev.map(s => s.id === sessionData.id ? sessionData : s));
                } else {
                    const newSession = { ...sessionData, id: uuidv4() };
                    setSessions(prev => [...prev, newSession]);
                }
                setIsFormOpen(false);
                setEditingSession(null);
            };

            const deleteSession = (id) => {
                setSessions(prev => prev.filter(s => s.id !== id));
                setIsFormOpen(false);
                setEditingSession(null);
            };

            const openAddModal = (dateStr) => {
                setEditingSession(null);
                setSelectedDate(dateStr || new Date().toISOString().split('T')[0]);
                setIsFormOpen(true);
            };

            const openEditModal = (session) => {
                setEditingSession(session);
                setIsFormOpen(true);
            };

            const handleAddTag = (tagData) => {
                const newTag = { ...tagData, id: uuidv4() };
                setTags(prev => [...prev, newTag]);
            };

            const handleDeleteTag = (id) => {
                setTags(prev => prev.filter(t => t.id !== id));
            };

            const getTagById = (id) => tags.find(t => t.id === id);

            return (
                <div className="min-h-screen flex flex-col md:flex-row max-w-[1800px] mx-auto p-4 md:p-8 gap-8 relative bg-orange-50 font-sans">
                
                {/* Mobile Header */}
                <div className="md:hidden flex justify-between items-center mb-4 border-b-2 border-gray-800 pb-2">
                    <div className="font-bold text-2xl text-gray-800 flex items-center gap-3">
                        <CatFaceIcon className="w-8 h-8" />
                        <span>ä¸‰è„šçŒ«æ‹æ‘„æ¡£æœŸ</span>
                    </div>
                    <button onClick={() => setViewMode(viewMode === 'calendar' ? 'tags' : 'calendar')} className="p-2 border-2 border-gray-800 rounded-lg active:bg-gray-100">
                        <Icons.Menu className="text-gray-800 w-6 h-6" />
                    </button>
                </div>

                {/* Reminder Banner */}
                {showNotification.length > 0 && (
                    <div className="fixed top-6 right-6 z-50 bg-white border-2 border-gray-800 shadow-[4px_4px_0px_0px_rgba(0,0,0,0.8)] rounded-lg p-4 flex items-start gap-4 max-w-sm">
                    <div className="bg-orange-100 p-2 rounded-full shrink-0 border border-gray-800">
                        <Icons.Bell className="w-5 h-5 text-gray-800" />
                    </div>
                    <div>
                        <h4 className="font-bold text-gray-800">æ˜å¤©æœ‰æ‹æ‘„ä»»åŠ¡ï¼</h4>
                        <p className="text-sm text-gray-600 mt-1 leading-relaxed">æ‚¨æœ‰ {showNotification.length} ä¸ªæ¡£æœŸéœ€è¦å‡†å¤‡ã€‚</p>
                        <button 
                        onClick={() => setShowNotification([])}
                        className="text-xs text-gray-800 font-bold mt-2 hover:underline"
                        >
                        æˆ‘çŸ¥é“äº†
                        </button>
                    </div>
                    </div>
                )}

                {/* Sidebar */}
                <div className={`md:w-64 flex flex-col gap-8 shrink-0 ${viewMode !== 'tags' && 'hidden md:flex'}`}>
                    <div className="hidden md:flex items-center gap-3 py-2 border-b-2 border-transparent">
                    <CatFaceIcon className="w-10 h-10 text-gray-800" />
                    <h1 className="text-2xl font-bold text-gray-800 tracking-tight">ä¸‰è„šçŒ«<br/>æ‹æ‘„æ¡£æœŸ</h1>
                    </div>

                    <button 
                    onClick={() => openAddModal()}
                    className="bg-gray-800 text-white p-4 rounded-xl flex items-center justify-center gap-3 shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,0.2)] hover:translate-x-[2px] hover:translate-y-[2px] transition-all border-2 border-gray-800"
                    >
                    <Icons.Plus className="w-6 h-6" />
                    <span className="font-bold text-lg">æ–°å¢æ‹æ‘„æ¡£æœŸ</span>
                    </button>

                    <div className="hidden md:block">
                        <TagManager tags={tags} onAdd={handleAddTag} onDelete={handleDeleteTag} />
                    </div>
                    
                    {/* Mobile Tag View */}
                    <div className="md:hidden block">
                        {viewMode === 'tags' && <TagManager tags={tags} onAdd={handleAddTag} onDelete={handleDeleteTag} />}
                    </div>
                </div>

                {/* Main Content Area */}
                <div className={`flex-1 flex flex-col h-full ${viewMode === 'tags' && 'hidden md:flex'}`}>
                    
                    {/* Calendar Container - "Paper" Look */}
                    <div className="flex-1 flex flex-col">
                    
                    {/* Header Area */}
                    <div className="flex justify-between items-end mb-4 px-1">
                        <div className="flex flex-col">
                            <span className="text-gray-500 font-bold text-sm">CURRENT VIEW</span>
                            <h2 className="text-4xl font-black text-gray-800 flex items-baseline gap-2">
                            {headerDate.getFullYear()}å¹´
                            <span className="text-orange-600">{headerDate.getMonth() + 1}æœˆ</span>
                            </h2>
                        </div>
                        <div className="flex items-center gap-2">
                            <button onClick={() => changeWeeks(-1)} className="p-2 border-2 border-gray-800 rounded-lg hover:bg-gray-100 transition-colors">
                            <Icons.ChevronLeft className="w-5 h-5 text-gray-800" />
                            </button>
                            <button onClick={() => changeWeeks(1)} className="p-2 border-2 border-gray-800 rounded-lg hover:bg-gray-100 transition-colors">
                            <Icons.ChevronRight className="w-5 h-5 text-gray-800" />
                            </button>
                        </div>
                    </div>

                    {/* Grid Container */}
                    <div className="bg-white border-2 border-gray-800 rounded-xl overflow-hidden shadow-[8px_8px_0px_0px_rgba(0,0,0,0.1)]">
                        
                        {/* Days Header */}
                        <div className="grid grid-cols-7 border-b-2 border-gray-800 bg-gray-50">
                        {WEEKDAYS.map((day, i) => (
                            <div key={day} className={`text-center font-bold py-3 text-lg border-r border-gray-800 last:border-r-0 ${i === 0 || i === 6 ? 'text-orange-600' : 'text-gray-800'}`}>
                            {day}
                            </div>
                        ))}
                        </div>

                        {/* Days Grid */}
                        <div className="grid grid-cols-7">
                        {calendarDays.map((date, index) => {
                            const dateStr = date.toISOString().split('T')[0];
                            const isToday = dateStr === new Date().toISOString().split('T')[0];
                            const daySessions = sessions.filter(s => s.date === dateStr);
                            
                            // Determine borders: Right border for all except last column (index % 7 === 6)
                            const isLastCol = (index + 1) % 7 === 0;
                            // Bottom border for all except last row. Since we show 21 days, indices 14-20 are last row.
                            const isLastRow = index >= 14;

                            return (
                            <div
                                key={dateStr}
                                onClick={() => openAddModal(dateStr)}
                                className={`
                                relative flex flex-col min-h-[12rem] p-2 transition-colors cursor-pointer group
                                border-b-2 border-gray-800 ${!isLastCol ? 'border-r-2 border-gray-800' : ''}
                                ${isToday ? 'bg-orange-50' : 'bg-white hover:bg-gray-50'}
                                ${isLastRow ? 'border-b-0' : ''}
                                `}
                            >
                                {/* Date Number */}
                                <div className="flex justify-between items-start mb-2">
                                <span className={`text-xl font-bold font-mono ${isToday ? 'text-orange-600 underline decoration-4 underline-offset-4' : 'text-gray-400'}`}>
                                    {date.getDate()}
                                </span>
                                {daySessions.length === 0 && (
                                    <Icons.Plus className="w-5 h-5 text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity" />
                                )}
                                </div>
                                
                                {/* Content: List Items */}
                                <div className="flex flex-col gap-2">
                                {daySessions.map(session => {
                                    const firstTag = getTagById(session.tags[0]);
                                    const tagColorClass = firstTag ? firstTag.color : 'bg-gray-200 text-gray-800';
                                    // Parse color safely
                                    const colorParts = tagColorClass.split('-');
                                    const colorName = colorParts.length > 1 ? colorParts[1] : 'gray';
                                    const dotColor = `bg-${colorName}-400`;

                                    return (
                                        <div 
                                        key={session.id} 
                                        onClick={(e) => { e.stopPropagation(); openEditModal(session); }}
                                        className="flex items-start gap-2 group/item"
                                        >
                                        {/* Bullet Point */}
                                        <div className={`w-2.5 h-2.5 rounded-full mt-1.5 shrink-0 ${dotColor} border border-gray-800`}></div>
                                        
                                        {/* Text Content */}
                                        <div className="text-sm font-bold text-gray-700 leading-tight group-hover/item:text-orange-600 transition-colors line-clamp-3 break-words">
                                            {session.notes || "æ— å¤‡æ³¨"}
                                        </div>
                                        </div>
                                    );
                                })}
                                </div>
                            </div>
                            );
                        })}
                        </div>
                    </div>
                    </div>
                </div>

                {/* Modal Overlay */}
                {isFormOpen && (
                    <div className="fixed inset-0 bg-gray-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="max-w-xl w-full max-h-[90vh] overflow-y-auto rounded-[2rem] cat-scroll animate-in fade-in zoom-in duration-200">
                        <SessionForm 
                        existingTags={tags} 
                        initialDate={editingSession?.date || selectedDate}
                        initialData={editingSession}
                        onSave={handleSaveSession}
                        onDelete={deleteSession}
                        onCancel={() => { setIsFormOpen(false); setEditingSession(null); }}
                        />
                    </div>
                    </div>
                )}
                
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>